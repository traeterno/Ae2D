# Скелеты

## Оглавление
- [Строение](#строение)
- [Риг](#риг)
	- [Невидимые кости](#невидимые-кости-нк)
	- [Видимые кости](#видимые-кости-вк)
- [Анимации](#анимации)
	- [Интерполяция](#интерполяция)
	- [Переход между анимациями](#переход-между-анимациями)
	- Ключевые кадры
- [Файловый формат](#файловый-формат)
	- [Риги](#пример-рига)
	- [Спрайт-листы](#пример-спрайт-листа)
	- [Аним-листы](#пример-аним-листа)

## Строение

Скелеты делятся на три составляющие: риг, спрайт-лист и аним-лист. Все они расположены в отдельных файлах и имеют [разную структуру](#файловый-формат).

## Риг

Риг состоит из иерархической системы видимых и невидимых костей, то есть:
- Родительская кость со своими длиной и углом;
	- Дочерняя кость №1;
	- - Дочерняя кость №1.1;
	- Дочерняя кость №2 и т.д.

### Невидимые кости (НК)

Невидимые кости - математические модели, обозначающие начало и конец каждого сегмента. Состоят из трёх компонентов:

- Длина (пиксели)
- Угол поворота (градусы, 0 направлен вниз, растёт по часовой)
- Начальная точка кости (х, у)

К *НК* можно привязать одну видимую кость.

### Видимые кости (ВК)

Видимая кость - спрайт, трансформация которого привязана к родительской *НК*. Она определяется единственным параметром, который указывает, какую текстуру использовать на нужной кости. Если параметр не указан или пуст (`""`), то считается, что кость полностью невидимая.

## Анимации

### Интерполяция

[Шпаргалка](https://easings.net)

Угол и масштабирование длины кости в анимациях подвергаются плавному изменению между ключевыми кадрами. Существует несколько доступных функций интерполяций:

- **Linear** - линейное изменение
- **Sine** - изменение по синусоиде
- **Cubic(In/Out/InOut)** - кубическое изменение

### Переход между анимациями

У каждой анимации есть параметр `transition`, определяющий время, затрачиваемое на переход между анимациями.

Переход между углами и масштабом костей линейный, текстура переходит по окончании транзита.

Также у анимаций есть параметр `loop`, определяющий, должна ли анимация возвращаться на старт по окончании.

Длительность анимации просчитывается автоматически и равна максимальной сумме временных точек ключевых кадров.

### Ключевые кадры

У каждой кости свой набор ключевых кадров.

## Файловый формат

### Пример рига

```json
{
	"root": {
		"angle": 180,
		"length": 100,
		"texture": "torso",
		"children": {}
	}
}
```

### Пример спрайт-листа

```json
{
	"texture": "res/tex/heroes/knight.png",
	"sprites": {
		"torso": {
			"rect": [ 0, 0, 10, 20 ],
			"offset": [ 5, 0 ]
		}
	}
}
```

### Пример аним-листа

```json
{
	"idle": {
		"loop": false,
		"transition": 0.1,
		"bones": {
			"root": {
				"inheritAngle": false,
				"frames": {
					"[timestamp] 0": {
						"angle": "Linear 0",
						"texture": "torso",
						"lengthScale": "Linear 1"
					},
					"0.5": {
						"angle": "CubicInOut 90",
						"texture": "",
						"lengthScale": "Sine 2"
					}
				}
			}
		}
	},
	"walkRight": {}
}
```